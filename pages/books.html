<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kitap Keşfi</title>
  <style>
    :root { --bg:#0b1221; --panel:#101a30; --accent:#22d3ee; --text:#e5e7eb; --muted:#94a3b8; }
    *{box-sizing:border-box;}
    body{margin:0;font-family:"Inter","Segoe UI",sans-serif;background:radial-gradient(circle at 20% 20%,rgba(34,211,238,0.08),transparent 30%),linear-gradient(135deg,#0b1221,#0f172a);color:var(--text);}
    header{max-width:1100px;margin:0 auto;padding:26px 16px 10px;}
    h1{margin:0;font-size:30px;}
    p.lead{margin:6px 0 0;color:var(--muted);}
    .panel{max-width:1100px;margin:0 auto 26px;padding:16px;background:var(--panel);border:1px solid rgba(255,255,255,0.06);border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,0.35);}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px;}
    input{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.12);background:#0c1528;color:#fff;min-width:220px;}
    .btn{border:none;padding:10px 14px;border-radius:10px;background:linear-gradient(120deg,rgba(34,211,238,0.6),rgba(168,85,247,0.5));color:#fff;cursor:pointer;transition:all .2s;box-shadow:0 10px 30px rgba(0,0,0,0.25);}
    .btn:hover{transform:translateY(-1px);box-shadow:0 15px 40px rgba(34,211,238,0.25);}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(34,211,238,0.12);color:#7dd3fc;border:1px solid rgba(34,211,238,0.3);cursor:pointer;}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;}
    .card{padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);background:#0f182c;}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(34,211,238,0.12);border:1px solid rgba(34,211,238,0.3);color:#7dd3fc;font-size:12px;}
    .muted{color:var(--muted);}
  </style>
</head>
<body>
  <header>
    <h1>Kitap Keşfi</h1>
    <p class="lead">OpenLibrary üzerinden konu/başlık arama, hızlı filtreler.</p>
  </header>
  <div class="panel">
    <div class="bar">
      <a class="btn" href="../index.html">Ana sayfa</a>
      <input id="q" placeholder="Konu veya başlık (örn: science)">
      <button class="btn" id="go">Ara</button>
      <span class="badge" id="status">Hazır</span>
    </div>
    <div class="chips" id="chips"></div>
    <div class="grid" id="grid"><div class="card">Arama ya da konu seçin.</div></div>
  </div>
  <script>
  (function(){
    const chips=document.getElementById("chips");
    const grid=document.getElementById("grid");
    const status=document.getElementById("status");
    const q=document.getElementById("q");
    const subjects=["science","history","fantasy","technology","business","philosophy","space"];
    chips.innerHTML=subjects.map(s=>`<span class="chip" data-sub="${s}">${s}</span>`).join("");
    chips.addEventListener("click",e=>{const s=e.target.dataset.sub;if(s) loadSubject(s);});

    document.getElementById("go").addEventListener("click",()=>search(q.value.trim()));
    q.addEventListener("keydown",e=>{if(e.key==="Enter") search(q.value.trim());});

    async function loadSubject(sub){
      try{
        status.textContent="Yükleniyor...";
        const res=await fetch(`https://openlibrary.org/subjects/${sub}.json?limit=18`);
        const j=await res.json();
        const works=j.works||[];
        if(!works.length){grid.innerHTML="<div class='card'>Sonuç yok</div>";status.textContent="Hazır";return;}
        grid.innerHTML=works
          .sort((a,b)=>(b.ratings_average||0)-(a.ratings_average||0))
          .slice(0,18).map(w=>`
          <div class="card">
            <div class="badge">${sub}</div>
            <strong>${w.title||""}</strong>
            <div class="muted">${w.authors?.[0]?.name||""} · ${w.first_publish_year||""}</div>
            <div class="muted">Puan: ${w.ratings_average ? w.ratings_average.toFixed(1) : "?"}</div>
            ${w.key ? `<a class="btn" href="https://openlibrary.org${w.key}" target="_blank" rel="noreferrer">Detay</a>` : ""}
          </div>
        `).join("");
        status.textContent="Hazır";
      }catch(err){
        status.textContent="Hata";
        grid.innerHTML="<div class='card'>Veri alınamadı.</div>";
      }
    }

    async function search(term){
      if(!term){grid.innerHTML="<div class='card'>Arama yapın.</div>";return;}
      try{
        status.textContent="Yükleniyor...";
        const res=await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(term)}&orderBy=relevance&maxResults=20&langRestrict=tr,en`);
        const j=await res.json();
        const items=j.items||[];
        if(!items.length){grid.innerHTML="<div class='card'>Sonuç yok</div>";status.textContent="Hazır";return;}
        grid.innerHTML=items
          .sort((a,b)=>((b.volumeInfo?.averageRating||0)-(a.volumeInfo?.averageRating||0)))
          .slice(0,16).map(it=>{
          const info=it.volumeInfo||{};
          return `<div class="card">
            <div class="badge">${(info.categories&&info.categories[0])||"Kategori"}</div>
            <strong>${info.title||""}</strong>
            <div class="muted">${(info.authors&&info.authors[0])||"Bilinmiyor"} · ${info.publishedDate||""}</div>
            <div class="muted" style="margin-top:4px;">Puan: ${info.averageRating ?? "?"}</div>
            ${info.infoLink ? `<div style="margin-top:8px;"><a class="btn" href="${info.infoLink}" target="_blank" rel="noreferrer">Detay</a></div>` : ""}
          </div>`;
        }).join("");
        status.textContent="Hazır";
      }catch(err){
        status.textContent="Hata";
        grid.innerHTML="<div class='card'>Veri alınamadı.</div>";
      }
    }
  })();
  </script>
</body>
</html>
