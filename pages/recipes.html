<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tarif + Besin</title>
  <style>
    :root{
      --bg:#050816;
      --panel:#0b1120;
      --accent:#22d3ee;
      --accent2:#a855f7;
      --text:#e5e7eb;
      --muted:#94a3b8;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:"Inter","Segoe UI",sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at 10% 0%,rgba(34,211,238,0.14),transparent 55%),
        radial-gradient(circle at 90% 100%,rgba(168,85,247,0.18),transparent 55%),
        linear-gradient(135deg,#020617,#020617 40%,#0b1221);
      min-height:100vh;
      overflow-x:hidden;
    }
    /* Arka planda yüzen Baseborn vari bloblar */
    body::before,
    body::after{
      content:"";
      position:fixed;
      inset:auto;
      width:420px;
      height:420px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 30%,rgba(34,211,238,0.34),transparent 60%);
      mix-blend-mode:screen;
      filter:blur(4px);
      opacity:0.85;
      z-index:-1;
      pointer-events:none;
      animation:blobA 22s ease-in-out infinite alternate;
    }
    body::after{
      width:520px;
      height:520px;
      background:radial-gradient(circle at 70% 70%,rgba(168,85,247,0.33),transparent 60%);
      animation:blobB 26s ease-in-out infinite alternate;
    }
    @keyframes blobA{
      0%{transform:translate3d(-20%, -10%,0) scale(1);}
      50%{transform:translate3d(10%,30%,0) scale(1.15);}
      100%{transform:translate3d(-5%,55%,0) scale(0.9);}
    }
    @keyframes blobB{
      0%{transform:translate3d(40%,-30%,0) scale(1.1);}
      50%{transform:translate3d(10%,10%,0) scale(0.95);}
      100%{transform:translate3d(35%,40%,0) scale(1.2);}
    }

    header{
      max-width:1100px;
      margin:0 auto;
      padding:26px 16px 10px;
      animation:fadeDown 0.8s ease-out forwards;
      opacity:0;
    }
    h1{
      margin:0;
      font-size:30px;
      letter-spacing:0.3px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    h1::after{
      content:"";
      flex:1;
      height:1px;
      background:linear-gradient(90deg,rgba(34,211,238,0.5),transparent);
      opacity:0.7;
    }
    p.lead{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
    }

    .panel{
      max-width:1100px;
      margin:0 auto 26px;
      padding:16px;
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.35);
      background:
        radial-gradient(circle at 0 0,rgba(34,211,238,0.12),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(168,85,247,0.18),transparent 55%),
        linear-gradient(145deg,rgba(15,23,42,0.97),rgba(15,23,42,0.88));
      box-shadow:
        0 24px 80px rgba(15,23,42,0.95),
        0 0 0 1px rgba(15,23,42,0.9) inset;
      backdrop-filter:blur(20px);
      position:relative;
      overflow:hidden;
      animation:fadeUp 0.9s 0.1s ease-out forwards;
      opacity:0;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 0 0,rgba(34,211,238,0.28),transparent 55%),
        radial-gradient(circle at 100% 0,rgba(168,85,247,0.24),transparent 55%);
      opacity:0;
      mix-blend-mode:soft-light;
      pointer-events:none;
      transition:opacity .5s ease;
    }
    .panel:hover::before{opacity:1;}

    .bar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:14px;
    }
    input{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.6);
      background:#020617;
      color:#fff;
      min-width:220px;
      outline:none;
      font-size:14px;
      box-shadow:0 0 0 1px rgba(15,23,42,1);
      transition:border-color .2s, box-shadow .2s, background .2s, transform .15s;
    }
    input::placeholder{
      color:rgba(148,163,184,0.8);
    }
    input:focus{
      border-color:var(--accent);
      box-shadow:
        0 0 0 1px rgba(15,23,42,1),
        0 0 0 1px rgba(34,211,238,0.7),
        0 0 20px rgba(34,211,238,0.35);
      background:#020617;
      transform:translateY(-1px);
    }

    .btn{
      border:none;
      padding:10px 14px;
      border-radius:999px;
      background:linear-gradient(120deg,rgba(34,211,238,0.9),rgba(168,85,247,0.9));
      color:#0b1120;
      cursor:pointer;
      font-weight:500;
      font-size:13px;
      letter-spacing:0.04em;
      text-transform:uppercase;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:transform .2s, box-shadow .2s, filter .2s, background .2s;
      box-shadow:0 18px 40px rgba(15,23,42,0.9),0 0 0 1px rgba(15,23,42,1);
      position:relative;
      overflow:hidden;
    }
    .btn::after{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 0 0,rgba(255,255,255,0.35),transparent 55%);
      opacity:0;
      transform:translate3d(-40%, -40%,0);
      transition:opacity .25s ease, transform .25s ease;
    }
    .btn:hover{
      transform:translateY(-1px) scale(1.01);
      box-shadow:
        0 22px 50px rgba(8,47,73,0.95),
        0 0 0 1px rgba(15,23,42,1);
      filter:saturate(1.1);
    }
    .btn:hover::after{
      opacity:0.9;
      transform:translate3d(0,0,0);
    }

    .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .chip{
      padding:7px 12px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      color:#7dd3fc;
      border:1px solid rgba(37,99,235,0.6);
      cursor:pointer;
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      position:relative;
      overflow:hidden;
      transition:color .2s, border-color .2s, background .2s, box-shadow .2s, transform .18s;
    }
    .chip::before{
      content:"";
      position:absolute;
      width:180%;
      height:180%;
      left:-40%;
      top:-40%;
      background:radial-gradient(circle at 0 0,rgba(56,189,248,0.6),transparent 55%);
      opacity:0;
      transition:opacity .25s, transform .25s;
      transform:translate3d(-30%,0,0);
      pointer-events:none;
      mix-blend-mode:screen;
    }
    .chip:hover{
      transform:translateY(-1px);
      background:rgba(15,23,42,1);
      border-color:rgba(56,189,248,0.85);
      box-shadow:0 18px 40px rgba(15,23,42,0.9);
    }
    .chip:hover::before{
      opacity:0.8;
      transform:translate3d(0,0,0);
    }
    .chip span{
      opacity:.7;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.08em;
    }
    .chip.active{
      color:#e0f2fe;
      background:linear-gradient(120deg,rgba(34,211,238,0.3),rgba(168,85,247,0.25));
      border-color:rgba(125,211,252,0.95);
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 16px 36px rgba(15,23,42,0.9);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:12px;
      margin-top:4px;
    }
    .card{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.4);
      background:radial-gradient(circle at 0 0,rgba(15,23,42,1),rgba(15,23,42,0.99));
      box-shadow:
        0 16px 40px rgba(15,23,42,0.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      position:relative;
      overflow:hidden;
      transform-style:preserve-3d;
      transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease;
      opacity:0;
      animation:cardIn 0.55s ease-out forwards;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 0 0,rgba(34,211,238,0.28),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(168,85,247,0.25),transparent 55%);
      opacity:0;
      mix-blend-mode:soft-light;
      transition:opacity .25s ease;
      pointer-events:none;
    }
    .card:hover{
      box-shadow:
        0 22px 60px rgba(8,47,73,0.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      border-color:rgba(129,140,248,0.8);
    }
    .card:hover::before{opacity:1;}
    .card h3{
      margin:4px 0 4px;
      font-size:15px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(15,23,42,1);
      border:1px solid rgba(56,189,248,0.65);
      color:#7dd3fc;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.08em;
    }
    .badge::before{
      content:"●";
      font-size:9px;
      color:#22c55e;
    }
    img.thumb{
      width:100%;
      border-radius:12px;
      margin-bottom:8px;
      display:block;
      object-fit:cover;
      max-height:190px;
    }
    .muted{color:var(--muted);font-size:12px;}

    #status{
      margin-left:auto;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      background:rgba(15,23,42,0.85);
      border-radius:999px;
      padding:6px 9px;
      border:1px solid rgba(148,163,184,0.7);
      box-shadow:0 0 0 1px rgba(15,23,42,1);
    }
    #status.bad{animation:shake 0.4s linear;}

    /* Küçük 3D mouse glow (Baseborn havası) */
    .cursor-glow{
      position:fixed;
      width:220px;
      height:220px;
      border-radius:999px;
      pointer-events:none;
      background:radial-gradient(circle at 50% 50%,rgba(56,189,248,0.5),transparent 65%);
      mix-blend-mode:screen;
      opacity:0;
      transform:translate3d(-50%,-50%,0);
      transition:opacity .25s ease-out;
      z-index:5;
    }

    @keyframes fadeDown{
      from{opacity:0;transform:translateY(-12px);}
      to{opacity:1;transform:translateY(0);}
    }

    .more-bar{
      justify-content:flex-end;
      margin-top:12px;
    }
    .btn-ghost{
      background:rgba(34,211,238,0.14);
      color:#e0f2fe;
      border:1px solid rgba(34,211,238,0.5);
      box-shadow:none;
    }
    .btn-ghost:hover{
      box-shadow:0 10px 30px rgba(34,211,238,0.25);
    }

    @media (max-width: 768px){
      .bar, .chips{
        flex-wrap:nowrap;
        overflow-x:auto;
        -webkit-overflow-scrolling:touch;
        padding-bottom:6px;
        margin-bottom:12px;
      }
      .bar::-webkit-scrollbar,
      .chips::-webkit-scrollbar{display:none;}
      .bar > *, .chips > *{
        flex:0 0 auto;
      }
      .panel{box-shadow:0 14px 44px rgba(0,0,0,0.78);backdrop-filter:blur(10px);}
    }
    @media (prefers-reduced-motion: reduce){
      *{animation:none !important;transition:none !important;}
    }
    @keyframes fadeUp{
      from{opacity:0;transform:translateY(14px);}
      to{opacity:1;transform:translateY(0);}
    }
    @keyframes cardIn{
      from{opacity:0;transform:translateY(14px) scale(.98);}
      to{opacity:1;transform:translateY(0) scale(1);}
    }
    @keyframes shake{
      0%,100%{transform:translateX(0);}
      25%{transform:translateX(-2px);}
      50%{transform:translateX(2px);}
      75%{transform:translateX(-1px);}
    }

    @media (max-width:640px){
      header{padding-top:20px;}
      h1{font-size:24px;}
      .panel{padding:14px;}
      .btn{padding:9px 12px;}
      #status{margin-left:0;}
    }
  
/* --- mobile-shared-opt --- */
@media(max-width:768px){
  .bar, .chips, .hero-actions, .topbar, .tab-bar, .filter-bar{
    flex-wrap:nowrap !important;
    overflow-x:auto;
    -webkit-overflow-scrolling:touch;
    gap:8px;
    padding-bottom:6px;
  }
  .bar::-webkit-scrollbar, .chips::-webkit-scrollbar, .hero-actions::-webkit-scrollbar, .topbar::-webkit-scrollbar, .tab-bar::-webkit-scrollbar, .filter-bar::-webkit-scrollbar{display:none;}
}
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{animation:none !important;transition:none !important;scroll-behavior:auto !important;}
}
/* --- end mobile-shared-opt --- */
</style>
</head>
<body>
  <div class="cursor-glow" id="cursorGlow"></div>

  <header>
    <h1 id="pageTitle">Tarif + Besin</h1>
    <p class="lead" id="pageLead">
      Malzeme ya da yemek adına göre arama; hızlı sonuç. İstersen rastgele öneri al.
    </p>
  </header>

  <div class="panel">
    <div class="bar">
      <a class="btn" href="../index.html" id="homeBtn">
        <span>Ana sayfa</span>
      </a>
      <input id="q" placeholder="Tarif veya malzeme (örn: chicken, beef, pasta)">
      <button class="btn" id="go">
        <span>Ara</span>
      </button>
      <span class="badge" id="status">Hazır</span>
    </div>

    <div class="chips" id="chips"></div>

    <div class="grid" id="grid">
      <div class="card" style="opacity:1;">
        <h3 id="welcomeTitle">Tarif + Besin'e hoş geldiniz</h3>
        <p class="muted" id="welcomeBody">
          Sayfa yüklenirken sizin için rastgele tarifler getirilecektir.
          Dilerseniz yukarıdan bir mutfak / kategori filtresi seçebilir veya arama yapabilirsiniz.
        </p>
      </div>
    </div>

    <div class="bar more-bar">
      <button class="btn btn-ghost" id="loadMore" style="display:none;">Daha fazla göster</button>
    </div>
  </div>

  <script>
  (function(){
    // Dil ayarı (localStorage'daki prefLang ile senkron)
    const pref = (typeof localStorage !== "undefined" && localStorage.getItem("prefLang")) || "en";
    const prefLang = pref === "tr" ? "tr" : "en";
    document.documentElement.lang = prefLang;

    const TXT = {
      tr:{
        title:"Tarif + Besin",
        heading:"Tarif + Besin",
        lead:"Malzeme ya da yemek adına göre arama; hızlı sonuç. İstersen rastgele öneri al.",
        home:"Ana sayfa",
        searchPlaceholder:"Tarif veya malzeme (örn: chicken, beef, pasta)",
        searchBtn:"Ara",
        statusReady:"Hazır",
        statusLoading:"Yükleniyor...",
        statusError:"Hata",
        welcomeTitle:"Tarif + Besin'e hoş geldiniz",
        welcomeBody:"Sayfa yüklenirken sizin için rastgele tarifler getirilecektir. Dilerseniz yukarıdan bir mutfak / kategori filtresi seçebilir veya arama yapabilirsiniz.",
        randomLoading:"Rastgele öneriler getiriliyor...",
        randomEmptyCard:"Şu anda rastgele tarif alınamadı, lütfen tekrar deneyin.",
        randomErrorCard:"Rastgele tarifler alınırken hata oluştu.",
        noSearchHint:"Arama girin, filtre seçin veya hızlı öneriye tıklayın.",
        noResults:"Sonuç bulunamadı.",
        apiError:"Veri alınamadı, lütfen daha sonra tekrar deneyin.",
        openRecipe:"Tarifi Aç",
        badgeRandom:"Öneri",
        loadMore:"Daha fazla göster",
        loadMoreRandom:"Yeni öneriler",
        filterRandomLabel:"Hızlı Öneri",
        filterRandomSub:"Random",
        filterKitchenSub:"Mutfak",
        filterCategorySub:"Kategori",
        kitchens:{
          Turkish:"Türk",
          Italian:"İtalyan",
          Japanese:"Japon",
          Indian:"Hint",
          American:"Amerikan",
          Chinese:"Çin",
          Mexican:"Meksika"
        },
        categories:{
          Chicken:"Tavuk",
          Beef:"Et (Beef)",
          Breakfast:"Kahvaltı",
          Vegan:"Vegan",
          Vegetarian:"Vejetaryen",
          Seafood:"Deniz ürünü",
          Dessert:"Tatlı",
          Starter:"Başlangıç",
          Side:"Yan yemek",
          Pasta:"Makarna"
        }
      },
      en:{
        title:"Recipe + Nutrition",
        heading:"Recipe + Nutrition",
        lead:"Search by ingredient or meal name; get quick results or ask for random picks.",
        home:"Home",
        searchPlaceholder:"Recipe or ingredient (e.g. chicken, beef, pasta)",
        searchBtn:"Search",
        statusReady:"Ready",
        statusLoading:"Loading...",
        statusError:"Error",
        welcomeTitle:"Welcome to Recipe + Nutrition",
        welcomeBody:"On load, we will fetch random recipes for you. You can also pick a cuisine / category filter above or run a search.",
        randomLoading:"Fetching random suggestions...",
        randomEmptyCard:"Could not get random recipes right now, please try again.",
        randomErrorCard:"An error occurred while fetching random recipes.",
        noSearchHint:"Type a query, select a filter, or click quick suggestion.",
        noResults:"No results found.",
        apiError:"Unable to fetch data, please try again later.",
        openRecipe:"Open recipe",
        badgeRandom:"Pick",
        loadMore:"Show more",
        loadMoreRandom:"New suggestions",
        filterRandomLabel:"Quick Pick",
        filterRandomSub:"Random",
        filterKitchenSub:"Cuisine",
        filterCategorySub:"Category",
        kitchens:{
          Turkish:"Turkish",
          Italian:"Italian",
          Japanese:"Japanese",
          Indian:"Indian",
          American:"American",
          Chinese:"Chinese",
          Mexican:"Mexican"
        },
        categories:{
          Chicken:"Chicken",
          Beef:"Beef",
          Breakfast:"Breakfast",
          Vegan:"Vegan",
          Vegetarian:"Vegetarian",
          Seafood:"Seafood",
          Dessert:"Dessert",
          Starter:"Starter",
          Side:"Side",
          Pasta:"Pasta"
        }
      }
    }[prefLang];

    // Statik metinleri uygula
    document.title = TXT.title;
    const pageTitleEl = document.getElementById("pageTitle");
    const pageLeadEl  = document.getElementById("pageLead");
    const homeBtn     = document.getElementById("homeBtn");
    const q           = document.getElementById("q");
    const goBtn       = document.getElementById("go");
    const status      = document.getElementById("status");
    const welcomeTitle= document.getElementById("welcomeTitle");
    const welcomeBody = document.getElementById("welcomeBody");
    const loadMoreBtn = document.getElementById("loadMore");

    if(pageTitleEl) pageTitleEl.textContent = TXT.heading;
    if(pageLeadEl)  pageLeadEl.textContent  = TXT.lead;
    if(homeBtn)     homeBtn.firstElementChild.textContent = TXT.home;
    if(q)           q.placeholder           = TXT.searchPlaceholder;
    if(goBtn)       goBtn.firstElementChild.textContent   = TXT.searchBtn;
    if(status)      status.textContent      = TXT.statusReady;
    if(welcomeTitle)welcomeTitle.textContent= TXT.welcomeTitle;
    if(welcomeBody) welcomeBody.textContent = TXT.welcomeBody;
    if(loadMoreBtn) loadMoreBtn.textContent = TXT.loadMore;

    const grid   = document.getElementById("grid");
    const chips  = document.getElementById("chips");
    const glow   = document.getElementById("cursorGlow");

    const PAGE_SIZE = 8;
    let currentMeals = [];
    let currentMode  = "";
    let currentMeta  = {};
    let visibleCount = 0;

    // Filtreler (dil bazlı label/sub)
    function buildFilters(){
      const filters = [];

      // Quick random
      filters.push({
        type:"random",
        value:"",
        label:TXT.filterRandomLabel,
        sub:TXT.filterRandomSub
      });

      // Kitchens / areas
      const areas = ["Turkish","Italian","Japanese","Indian","American","Chinese","Mexican"];
      areas.forEach(a=>{
        filters.push({
          type:"area",
          value:a,
          label:TXT.kitchens[a] || a,
          sub:TXT.filterKitchenSub
        });
      });

      // Categories
      const cats = ["Chicken","Beef","Breakfast","Vegan","Vegetarian","Seafood","Dessert","Starter","Side","Pasta"];
      cats.forEach(c=>{
        filters.push({
          type:"category",
          value:c,
          label:TXT.categories[c] || c,
          sub:TXT.filterCategorySub
        });
      });

      return filters;
    }

    const filterDefs = buildFilters();

    chips.innerHTML = filterDefs.map((f,i)=>`
      <button class="chip${i===0 ? " active" : ""}"
              data-type="${f.type}"
              data-val="${f.value}">
        ${f.label}
        <span>${f.sub}</span>
      </button>
    `).join("");

    function setActiveChip(btn){
      chips.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      if(btn) btn.classList.add("active");
    }

    function updateMeals(meals, mode, meta={}){
      currentMeals = meals;
      currentMode  = mode;
      currentMeta  = meta;
      visibleCount = Math.min(meals.length, PAGE_SIZE);
      renderMeals();
    }

    function toggleLoadMore(){
      if(!loadMoreBtn) return;
      const hasMore = currentMode === "random" || currentMeals.length > visibleCount;
      loadMoreBtn.style.display = hasMore && currentMeals.length ? "inline-flex" : "none";
      loadMoreBtn.disabled = false;
      loadMoreBtn.textContent = currentMode === "random" ? TXT.loadMoreRandom : TXT.loadMore;
    }

    // Mouse glow ve kart tilt
    document.addEventListener("mousemove", (e)=>{
      if(!glow) return;
      glow.style.opacity = 0.85;
      glow.style.transform = `translate3d(${e.clientX}px, ${e.clientY}px, 0)`;
    });

    grid.addEventListener("mousemove", (e)=>{
      const card = e.target.closest(".card");
      if(!card) return;
      const rect = card.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = (e.clientY - rect.top) / rect.height;
      const maxTilt = 6;
      const rotateX = (0.5 - y) * maxTilt;
      const rotateY = (x - 0.5) * maxTilt;
      card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-4px)`;
    });

    grid.addEventListener("mouseleave", (e)=>{
      const card = e.target.closest && e.target.closest(".card");
      if(card){
        card.style.transform = "";
      }
    }, true);

    async function fetchRandomBatch(count=9){
      const requests = Array.from({length:count}, () =>
        fetch("https://www.themealdb.com/api/json/v1/1/random.php").then(r=>r.json())
      );
      const results = await Promise.all(requests);
      const meals = [];
      results.forEach(j=>{
        if(j && j.meals && j.meals[0]) meals.push(j.meals[0]);
      });
      return meals;
    }

    async function loadRandomMeals(count=9){
      try{
        status.textContent = TXT.randomLoading;
        status.classList.remove("bad");
        const meals = await fetchRandomBatch(count);
        if(!meals.length){
          currentMeals = [];
          grid.innerHTML = `<div class='card' style='opacity:1;'><p class='muted'>${TXT.randomEmptyCard}</p></div>`;
          status.textContent = TXT.statusReady;
          toggleLoadMore();
          return;
        }
        updateMeals(meals,"random",{});
        status.textContent = TXT.statusReady;
      }catch(err){
        console.error(err);
        status.textContent = TXT.statusError;
        status.classList.add("bad");
        grid.innerHTML = `<div class='card' style='opacity:1;'><p class='muted'>${TXT.randomErrorCard}</p></div>`;
        toggleLoadMore();
      }
    }

    async function run(type, value){
      try{
        status.textContent = TXT.statusLoading;
        status.classList.remove("bad");

        const term = q.value.trim();
        let url  = "";
        let mode = "search";
        let meta = {};

        if(type === "random"){
          const chipRandom = chips.querySelector(".chip[data-type='random']");
          setActiveChip(chipRandom);
          await loadRandomMeals();
          return;
        }else if(type === "area"){
          url = `https://www.themealdb.com/api/json/v1/1/filter.php?a=${encodeURIComponent(value)}`;
          mode = "filter";
          meta = {badge:value, category:""};
        }else if(type === "category"){
          url = `https://www.themealdb.com/api/json/v1/1/filter.php?c=${encodeURIComponent(value)}`;
          mode = "filter";
          meta = {badge:"", category:value};
        }else if(term){
          url = `https://www.themealdb.com/api/json/v1/1/search.php?s=${encodeURIComponent(term)}`;
          mode = "search";
          meta = {};
        }else{
          grid.innerHTML = `<div class='card' style='opacity:1;'><p class='muted'>${TXT.noSearchHint}</p></div>`;
          status.textContent = TXT.statusReady;
          currentMeals = [];
          toggleLoadMore();
          return;
        }

        const r = await fetch(url);
        const j = await r.json();
        const meals = j.meals || [];
        if(!meals.length){
          grid.innerHTML = `<div class='card' style='opacity:1;'><p class='muted'>${TXT.noResults}</p></div>`;
          status.textContent = TXT.statusReady;
          currentMeals = [];
          toggleLoadMore();
          return;
        }

        updateMeals(meals.slice(0,24), mode, meta);
        status.textContent = TXT.statusReady;
      }catch(e){
        console.error(e);
        status.textContent = TXT.statusError;
        status.classList.add("bad");
        grid.innerHTML = `<div class='card' style='opacity:1;'><p class='muted'>${TXT.apiError}</p></div>`;
        currentMeals = [];
        toggleLoadMore();
      }
    }

    function renderMeals(){
      if(!currentMeals.length){
        grid.innerHTML = `<div class='card' style='opacity:1;'><p class='muted'>${TXT.noResults}</p></div>`;
        toggleLoadMore();
        return;
      }
      const meals = currentMeals.slice(0, visibleCount);
      grid.innerHTML = meals.map((m,idx)=> {
        const areaLabel = m.strArea || currentMeta.badge || "";
        const categoryLabel =
          m.strCategory || currentMeta.category || (currentMode === "search" ? "" : "");
        const delay = 0.03 * idx;
        return `
          <div class="card" style="animation-delay:${delay}s;">
            ${areaLabel ? `<span class="badge">${areaLabel}</span>` : ""}
            ${m.strMealThumb ? `<img class="thumb" src="${m.strMealThumb}" alt="${m.strMeal || ""}">` : ""}
            <h3>${m.strMeal || ""}</h3>
            <p class="muted">${categoryLabel}</p>
            ${
              m.strSource
                ? `<a class="btn" href="${m.strSource}" target="_blank" rel="noreferrer">
                     <span>${TXT.openRecipe}</span>
                   </a>`
                : ""
            }
          </div>
        `;
      }).join("");
      toggleLoadMore();
    }

    async function handleLoadMore(){
      if(!currentMeals.length) return;
      if(currentMode === "random"){
        loadMoreBtn.disabled = true;
        loadMoreBtn.textContent = TXT.statusLoading;
        try{
          const extra = await fetchRandomBatch(6);
          currentMeals = currentMeals.concat(extra);
        }catch(err){
          console.error(err);
        }
      }
      visibleCount = Math.min(currentMeals.length, visibleCount + PAGE_SIZE);
      renderMeals();
    }

    chips.addEventListener("click",(e)=>{
      const btn = e.target.closest(".chip");
      if(!btn) return;
      const t = btn.dataset.type;
      const v = btn.dataset.val || "";
      setActiveChip(btn);
      run(t,v);
    });

    loadMoreBtn?.addEventListener("click", handleLoadMore);
    document.getElementById("go").addEventListener("click", ()=>run());
    q.addEventListener("keydown", e=>{ if(e.key === "Enter") run(); });

    // İlk açılışta rastgele yemekler
    loadRandomMeals();

  })();
  </script>
  <script src="../lang-helper.js"></script>
  <script src="../scroll-helper.js"></script>
</body>
</html>
