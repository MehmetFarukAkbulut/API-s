<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kur / DÃ¶viz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg:#0b1221;
      --panel:#101a30;
      --accent:#22d3ee; /* AÃ§Ä±k Mavi */
      --accent2:#a855f7;
      --text:#e5e7eb; /* Beyaz/AÃ§Ä±k Gri */
      --muted:#94a3b8;
      --danger:#ef4444;
      --success:#22c55e;
      --modal-bg: rgba(0, 0, 0, 0.7); /* Modal arka plan karartma */
    }
    
    /* MODAL (WIDGET) Ã–ZEL CSS STÄ°LLERÄ° */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-bg);
      display: none; /* VarsayÄ±lan olarak gizli */
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.open {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: var(--panel);
      padding: 20px;
      border-radius: 18px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      transform: translateY(-50px);
      transition: transform 0.3s ease, opacity 0.3s ease;
      opacity: 0;
      border: 1px solid rgba(148,163,184,0.35);
      color: var(--text); /* Modal iÃ§indeki genel metin rengi artÄ±k aÃ§Ä±k */
    }
    .modal-overlay.open .modal-content {
      transform: translateY(0);
      opacity: 1;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(148,163,184,0.3);
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      color: var(--accent); /* BaÅŸlÄ±k rengi aÃ§Ä±k mavi */
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .modal-close:hover {
      color: var(--text);
    }

    /* Grafik ve detay alanÄ± */
    #chartContainer {
      width: 100%;
      height: 300px; /* Grafik yÃ¼ksekliÄŸi */
      margin-bottom: 15px;
      background: rgba(15,23,42,0.8);
      border-radius: 10px;
      padding: 10px;
    }
    
    /* Stat KartlarÄ± CSS */
    .stat-card {
        padding: 8px 10px;
        border-radius: 8px;
        background: rgba(15,23,42,0.95);
        border: 1px solid rgba(148,163,184,0.2);
    }
    .stat-label {
        margin: 0 0 4px;
        font-size: 11px;
        color: var(--muted);
    }
    /* GÃ¼ncel kur deÄŸeri aÃ§Ä±k mavi yapÄ±ldÄ± */
    .stat-card #statCurrentRate {
        color: var(--accent) !important; 
    }

    /* Orijinal CSS kodu buradan devam ediyor */
    
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:"Inter","Segoe UI",sans-serif;
      background:
        radial-gradient(circle at 10% 0%,rgba(34,211,238,0.10),transparent 45%),
        radial-gradient(circle at 90% 100%,rgba(168,85,247,0.10),transparent 45%),
        linear-gradient(135deg,#020617,#020617 20%,#020617 40%,#020617 60%,#020617);
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Arka planda yÃ¼zen glowlar */
    .orb {
      position:fixed;
      width:340px;
      height:340px;
      border-radius:999px;
      filter:blur(80px);
      opacity:0.35;
      z-index:-1;
      mix-blend-mode:screen;
      pointer-events:none;
      animation: float-orb 16s ease-in-out infinite alternate;
    }
    .orb.orb-a{
      top:-120px;left:-80px;
      background:radial-gradient(circle,var(--accent),transparent 70%);
      animation-delay:0s;
    }
    .orb.orb-b{
      bottom:-160px;right:-100px;
      background:radial-gradient(circle,var(--accent2),transparent 70%);
      animation-delay:2.5s;
    }
    @keyframes float-orb{
      0%{transform:translate3d(0,0,0) scale(1);}
      50%{transform:translate3d(40px,30px,0) scale(1.05);}
      100%{transform:translate3d(-40px,-20px,0) scale(0.98);}
    }

    header{
      max-width:1100px;
      margin:0 auto;
      padding:26px 16px 10px;
      position:relative;
    }
    h1{
      margin:0;
      font-size:30px;
      letter-spacing:0.3px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    h1 span.spark{
      width:18px;
      height:18px;
      border-radius:999px;
      background:radial-gradient(circle,var(--accent),transparent 70%);
      box-shadow:0 0 15px rgba(34,211,238,0.7);
      animation:pulse-spark 2.6s ease-in-out infinite;
    }
    @keyframes pulse-spark{
      0%,100%{transform:scale(0.9);opacity:0.8;}
      50%{transform:scale(1.15);opacity:1;}
    }
    p.lead{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
    }

    /* Header altÄ± ince animasyon Ã§izgi */
    .header-bar {
      position:relative;
      margin-top:10px;
      height:1px;
      background:linear-gradient(90deg,transparent,rgba(148,163,184,0.45),transparent);
      overflow:hidden;
    }
    .header-bar::after{
      content:"";
      position:absolute;
      top:0;bottom:0;
      width:110px;
      background:linear-gradient(90deg,transparent,rgba(34,211,238,1),transparent);
      animation: sweep 3.5s linear infinite;
    }
    @keyframes sweep{
      0%{transform:translateX(-30%);}
      100%{transform:translateX(260%);}
    }

    .panel{
      max-width:1100px;
      margin:14px auto 26px;
      padding:16px;
      background:var(--panel);
      border-radius:18px;
      position:relative;
      border:1px solid rgba(148,163,184,0.35);
      box-shadow:
        0 26px 80px rgba(15,23,42,0.95),
        0 0 0 1px rgba(15,23,42,0.9) inset;
      overflow:hidden;
      backdrop-filter:blur(16px);
    }
    .panel > .bar{
      flex-wrap:wrap !important;
      overflow:visible !important;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:inherit;
      background:
        radial-gradient(circle at 0 0,rgba(34,211,238,0.25),transparent 60%),
        radial-gradient(circle at 100% 100%,rgba(168,85,247,0.25),transparent 60%);
      opacity:0.0;
      pointer-events:none;
      z-index:-1;
      animation: panel-glow 12s ease-in-out infinite alternate;
    }
    @keyframes panel-glow{
      0%{opacity:0.08;transform:translate3d(0,0,0);}
      50%{opacity:0.18;transform:translate3d(0,-4px,0);}
      100%{opacity:0.08;transform:translate3d(0,3px,0);}
    }

    .bar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:12px;
    }

    input, select{
      padding:9px 11px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
      min-width:140px;
      font-size:13px;
      outline:none;
      transition:border-color .18s ease, box-shadow .18s ease, background .18s ease, transform .18s ease;
    }
    input::placeholder{color:var(--muted);}
    input:focus, select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(34,211,238,0.7),0 0 32px rgba(34,211,238,0.2);
      background:#020617;
      transform:translateY(-1px);
    }

    .btn{
      border:none;
      padding:10px 16px;
      border-radius:999px;
      background:linear-gradient(120deg,rgba(34,211,238,0.7),rgba(168,85,247,0.7));
      color:#fff;
      cursor:pointer;
      font-size:13px;
      font-weight:500;
      letter-spacing:0.02em;
      position:relative;
      overflow:hidden;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow:0 12px 30px rgba(15,23,42,0.9);
      transform:translateY(0) scale(1);
      transition:
        transform .18s ease,
        box-shadow .18s ease,
        filter .18s ease,
        background-position .35s ease;
      background-size:220% 220%;
      background-position:0% 50%;
    }
    .btn::after{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle,rgba(255,255,255,0.28),transparent 55%);
      opacity:0;
      transform:translate3d(-40%,0,0);
      transition:opacity .35s ease,transform .35s ease;
      pointer-events:none;
    }
    .btn:hover{
      transform:translateY(-1px) scale(1.02);
      box-shadow:0 18px 40px rgba(15,23,42,0.95);
      filter:brightness(1.05);
      background-position:100% 50%;
    }
    .btn:active{
      transform:translateY(0) scale(0.98);
      box-shadow:0 8px 22px rgba(15,23,42,0.9);
    }
    .btn:hover::after{
      opacity:1;
      transform:translate3d(35%,0,0);
    }
    .btn.btn-range{
      padding:6px 12px;
      font-size:12px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.5);
      box-shadow:none;
      background-size:100% 100%;
    }
    .btn.btn-range:hover{
      background:radial-gradient(circle at 0 0,rgba(34,211,238,0.3),rgba(15,23,42,1));
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(34,211,238,0.4);
    }
    .btn.btn-range.active{
      background:linear-gradient(120deg,rgba(34,211,238,0.8),rgba(168,85,247,0.8));
      border-color:transparent;
      box-shadow:0 12px 32px rgba(34,211,238,0.4);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(34,211,238,0.08);
      border:1px solid rgba(34,211,238,0.6);
      color:#7dd3fc;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      white-space:nowrap;
    }
    .badge-dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 10px rgba(34,197,94,0.9);
    }
    #status{
      margin-left:auto;
      font-size:11px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.65);
      background:rgba(15,23,42,0.9);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    #status::before{
      content:"";
      width:7px;
      height:7px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 12px rgba(34,197,94,0.9);
      flex-shrink:0;
    }
    #status.is-loading{
      border-color:rgba(34,211,238,0.8);
      color:#e5e7eb;
      animation: status-pulse 1.1s ease-in-out infinite;
    }
    #status.is-loading::before{
      background:var(--accent);
      box-shadow:0 0 16px rgba(34,211,238,1);
      animation: dot-pulse 0.9s ease-in-out infinite;
    }
    #status.is-error{
      border-color:var(--danger);
      color:#fecaca;
    }
    #status.is-error::before{
      background:var(--danger);
      box-shadow:0 0 14px rgba(248,113,113,1);
    }
    @keyframes status-pulse{
      0%,100%{transform:translateY(0);box-shadow:0 0 0 0 rgba(34,211,238,0.0);}
      50%{transform:translateY(-1px);box-shadow:0 0 0 4px rgba(34,211,238,0.35);}
    }
    @keyframes dot-pulse{
      0%,100%{transform:scale(0.92);}
      50%{transform:scale(1.2);}
    }

    .card{
      padding:14px 14px 13px;
      border-radius:14px;
      border:1px solid rgba(51,65,85,0.9);
      background:radial-gradient(circle at 0 0,rgba(148,163,184,0.15),rgba(15,23,42,1));
      margin-bottom:10px;
      position:relative;
      overflow:hidden;
      box-shadow:0 14px 35px rgba(15,23,42,0.9);
      transform:translateY(0) translateZ(0);
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
      opacity:0;
      animation: fade-up 0.38s ease-out forwards;
      /* TÄ±klanabilir kartlar iÃ§in cursor ayarÄ± */
      cursor:pointer;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 0 0,rgba(34,211,238,0.28),transparent 55%);
      opacity:0;
      transform:translate3d(-30%,0,0);
      transition:opacity .3s ease,transform .3s ease;
      pointer-events:none;
    }
    .card:hover{
      transform:translateY(-3px);
      box-shadow:0 20px 40px rgba(15,23,42,1);
      border-color:rgba(148,163,184,0.9);
      background:radial-gradient(circle at 0 0,rgba(148,163,184,0.2),rgba(15,23,42,1));
    }
    .card:hover::before{
      opacity:1;
      transform:translate3d(10%,0,0);
    }
    .card-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:4px;
    }
    .card-main{
      font-size:14px;
      margin-bottom:2px;
    }
    .card-sub{
      font-size:12px;
      color:var(--muted);
    }
    .change-line{
      font-size:12px;
      margin-top:4px;
    }

    @keyframes fade-up{
      0%{opacity:0;transform:translateY(8px);}
      100%{opacity:1;transform:translateY(0);}
    }

    .rates{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:10px;
      margin-top:10px;
    }

    .muted{color:var(--muted);font-size:12px;}

    .num-anim{
      display:inline-block;
      animation: num-pop .32s ease-out;
      transform-origin:bottom left;
    }
    @keyframes num-pop{
      0%{transform:translateY(3px) scale(0.94);opacity:0;}
      100%{transform:translateY(0) scale(1);opacity:1;}
    }

    /* Skeleton / boÅŸ veri */
    .skeleton{
      background:linear-gradient(
        90deg,
        rgba(148,163,184,0.12),
        rgba(148,163,184,0.3),
        rgba(148,163,184,0.12)
      );
      background-size:200% 100%;
      animation:skeleton 1.3s ease-in-out infinite;
      border-radius:999px;
      height:10px;
    }
    @keyframes skeleton{
      0%{background-position:0% 50%;}
      100%{background-position:200% 50%;}
    }

    @media (max-width:640px){
      header{padding-top:20px;}
      h1{font-size:24px;}
      .panel{margin:10px 8px 24px;padding:14px;}
      .bar{gap:8px;}
      #status{margin-left:0;margin-top:4px;}
    }
  
/* --- mobile-shared-opt --- */
@media(max-width:768px){
  .bar, .chips, .hero-actions, .topbar, .tab-bar, .filter-bar{
    flex-wrap:nowrap !important;
    overflow-x:auto;
    -webkit-overflow-scrolling:touch;
    gap:8px;
    padding-bottom:6px;
  }
  .bar::-webkit-scrollbar, .chips::-webkit-scrollbar, .hero-actions::-webkit-scrollbar, .topbar::-webkit-scrollbar, .tab-bar::-webkit-scrollbar, .filter-bar::-webkit-scrollbar{display:none;}
}
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{animation:none !important;transition:none !important;scroll-behavior:auto !important;}
}
/* --- end mobile-shared-opt --- */
  </style>
</head>
<body>
  <div class="orb orb-a"></div>
  <div class="orb orb-b"></div>

  <header>
    <h1>
      <span class="spark"></span>
      <span id="titleText">Kur / DÃ¶viz</span>
    </h1>
    <p class="lead" id="leadText">Frankfurter API ile baz kur, tarih ve miktar dÃ¶nÃ¼ÅŸtÃ¼rme.</p>
    <div class="header-bar"></div>
  </header>

  <div class="panel">
    <div class="bar">
      <a class="btn" href="../index.html" id="homeBtn">
        <span id="homeBtnText">Ana Sayfa</span>
      </a>
      <select id="base">
        <option>USD</option>
        <option>EUR</option>
        <option>GBP</option>
        <option>TRY</option>
        <option>CHF</option>
        <option>CAD</option>
        <option>AUD</option>
      </select>
      <input type="date" id="date">
      <input type="number" id="amt" value="100" min="1" step="1" placeholder="Miktar">
      <button class="btn" id="go">
        <span>â–¶</span><span id="goText">Hesapla</span>
      </button>
      <span class="status badge" id="status">HazÄ±r</span>
    </div>

    <div class="bar">
      <button class="btn btn-range" data-range="1g" id="btnRange1">1G</button>
      <button class="btn btn-range" data-range="5g" id="btnRange5">5G</button>
      <button class="btn btn-range" data-range="1m" id="btnRangeM">1 Ay</button>
    </div>

    <div id="result" class="card" style="animation-delay:0s;">
      <div class="skeleton" style="width:40%;margin-bottom:6px;"></div>
      <div class="skeleton" style="width:65%;"></div>
    </div>
    <div class="rates" id="rates"></div>
  </div>

  <div class="modal-overlay" id="rateModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">DetaylÄ± Kur Analizi</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div id="chartContainer">
        <canvas id="rateChart"></canvas>
      </div>
      <div id="statsSection">
        <h4 style="color:var(--accent); margin:15px 0 10px; border-bottom:1px solid rgba(148,163,184,0.3); padding-bottom:5px;">ðŸ“ˆ Analiz ve Ä°statistikler</h4>
        <div id="statsGrid" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:15px;">
          <div class="stat-card">
            <p class="stat-label muted">GÃ¼ncel Kur</p>
            <p class="stat-value" id="statCurrentRate" style="font-weight:bold; color:var(--accent); font-size:16px;">--</p>
          </div>
          <div class="stat-card">
            <p class="stat-label muted">30 GÃ¼nlÃ¼k DeÄŸiÅŸim</p>
            <p class="stat-value" id="statChangePerc" style="font-weight:bold; font-size:16px; color:var(--success);">--</p>
          </div>
          <div class="stat-card">
            <p class="stat-label muted">En YÃ¼ksek (30G)</p>
            <p class="stat-value" id="statHighest" style="color:var(--accent); font-size:16px;">--</p>
          </div>
          <div class="stat-card">
            <p class="stat-label muted">En DÃ¼ÅŸÃ¼k (30G)</p>
            <p class="stat-value" id="statLowest" style="color:var(--accent2); font-size:16px;">--</p>
          </div>
        </div>
        <p class="muted" id="infoDetail" style="margin-top:10px;"></p>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // Dil tercihi (tr / en) â€“ diÄŸer sayfalarla uyumlu
    const pref = (typeof localStorage !== "undefined" && localStorage.getItem("prefLang")) || "en";
    const prefLang = pref === "tr" ? "tr" : "en";
    document.documentElement.lang = prefLang;

    const texts = {
      tr: {
        pageTitle: "Kur / DÃ¶viz",
        heading: "Kur / DÃ¶viz",
        lead: "Frankfurter API ile baz kur, tarih ve miktar dÃ¶nÃ¼ÅŸtÃ¼rme.",
        home: "Ana Sayfa",
        go: "Hesapla",
        statusReady: "HazÄ±r",
        statusLoading: "YÃ¼kleniyor...",
        statusError: "Hata",
        baseLabel: "Baz",
        dateLabel: "Tarih",
        mainBadge: "Kur Bilgisi",
        totalLabel: "Toplam kur",
        mainSub: "SeÃ§ilen baz kura gÃ¶re tÃ¼m karÅŸÄ± para birimlerinin son deÄŸerleri listelenmiÅŸtir.",
        errorText: "Veri alÄ±namadÄ±. LÃ¼tfen baÄŸlantÄ±yÄ± veya tarihi kontrol edin.",
        placeholderAmount: "Miktar",
        range: {
          "1g": "1G",
          "5g": "5G",
          "1m": "1 Ay"
        },
        compareDatePrefix: "Ã–nceki",
        compareLabel: (refDate) => refDate + " itibarÄ±yla",
        modalTitle: (base, target) => `${friendly(target)} (${target}) / ${friendly(base)} (${base}) Analizi`,
        modalLoading: "Grafik verileri yÃ¼kleniyor...",
        modalNoData: "GeÃ§miÅŸ veri alÄ±namadÄ±. GrafiÄŸi gÃ¶rÃ¼ntÃ¼lemek iÃ§in tarihi veya aralÄ±ÄŸÄ± deÄŸiÅŸtirin."
      },
      en: {
        pageTitle: "FX / Currencies",
        heading: "FX / Currencies",
        lead: "Base currency, date and amount conversion via Frankfurter API.",
        home: "Home",
        go: "Calculate",
        statusReady: "Ready",
        statusLoading: "Loading...",
        statusError: "Error",
        baseLabel: "Base",
        dateLabel: "Date",
        mainBadge: "Rates",
        totalLabel: "Total pairs",
        mainSub: "All target currencies relative to the selected base are listed with latest values.",
        errorText: "Failed to fetch data. Please check your connection or date.",
        placeholderAmount: "Amount",
        range: {
          "1g": "1D",
          "5g": "5D",
          "1m": "1M"
        },
        compareDatePrefix: "Previous",
        compareLabel: (refDate) => "Ref: " + refDate,
        modalTitle: (base, target) => `${friendly(target)} (${target}) / ${friendly(base)} (${base}) Analysis`,
        modalLoading: "Loading chart data...",
        modalNoData: "Could not fetch historical data. Change the date or range to view the chart."
      }
    };

    const t = texts[prefLang];

    // Statik metinleri uygula
    document.title = t.pageTitle;
    const titleText = document.getElementById("titleText");
    const leadText = document.getElementById("leadText");
    const homeBtnText = document.getElementById("homeBtnText");
    const goText = document.getElementById("goText");
    const amtInput = document.getElementById("amt");
    const btnRange1 = document.getElementById("btnRange1");
    const btnRange5 = document.getElementById("btnRange5");
    const btnRangeM = document.getElementById("btnRangeM");

    if(titleText) titleText.textContent = t.heading;
    if(leadText) leadText.textContent = t.lead;
    if(homeBtnText) homeBtnText.textContent = t.home;
    if(goText) goText.textContent = t.go;
    if(amtInput) amtInput.placeholder = t.placeholderAmount;
    if(btnRange1) btnRange1.textContent = t.range["1g"];
    if(btnRange5) btnRange5.textContent = t.range["5g"];
    if(btnRangeM) btnRangeM.textContent = t.range["1m"];

    const baseEl = document.getElementById("base");
    const dateEl = document.getElementById("date");
    const amtEl = document.getElementById("amt");
    const resEl = document.getElementById("result");
    const ratesEl = document.getElementById("rates");
    const status = document.getElementById("status");
    const rangeButtons = document.querySelectorAll(".btn-range");
    
    // Modal Elementleri
    const rateModal = document.getElementById("rateModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalClose = document.getElementById("modalClose");
    const rateChartCanvas = document.getElementById("rateChart");
    const infoDetail = document.getElementById("infoDetail");
    const rootStyles = getComputedStyle(document.documentElement);
    const chartTextColor  = rootStyles.getPropertyValue('--text').trim()  || '#e5e7eb';
    const chartMutedColor = rootStyles.getPropertyValue('--muted').trim() || '#9ca3af';
    const chartBgColor    = 'rgba(15,23,42,0.95)';
    // Stat Elementleri
    const statCurrentRate = document.getElementById("statCurrentRate");
    const statChangePerc = document.getElementById("statChangePerc");
    const statHighest = document.getElementById("statHighest");
    const statLowest = document.getElementById("statLowest");

    let rateChartInstance = null; // Chart.js nesnesini tutmak iÃ§in

    const today = new Date();
    const isoToday = today.toISOString().slice(0,10);
    dateEl.value = isoToday;
    dateEl.max = isoToday;
    
    // Frankfurter'Ä±n desteklediÄŸi popÃ¼ler kurlarÄ± tam isimleriyle eÅŸleÅŸtirir
    function friendly(code){
      const mapEn = { USD:"US Dollar", EUR:"Euro", TRY:"Turkish Lira", GBP:"Pound Sterling", CHF:"Swiss Franc", CAD:"Canadian Dollar", AUD:"Australian Dollar" };
      const mapTr = { USD:"ABD DolarÄ±", EUR:"Euro", TRY:"TÃ¼rk LirasÄ±", GBP:"Ä°ngiliz Sterlini", CHF:"Ä°sviÃ§re FrangÄ±", CAD:"Kanada DolarÄ±", AUD:"Avustralya DolarÄ±" };
      const m = prefLang === "tr" ? mapTr : mapEn;
      return m[code] || code;
    }

    async function fetchRates(base,date){
      const url = date
        ? `https://api.frankfurter.app/${date}?from=${base}`
        : `https://api.frankfurter.app/latest?from=${base}`;
      const r = await fetch(url);
      if(!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    }
    
    async function fetchHistoricalRates(base, target, periodDays){
      const endDate = dateEl.value || isoToday;
      const startDate = new Date(endDate);
      startDate.setDate(startDate.getDate() - periodDays);
      const isoStartDate = startDate.toISOString().slice(0,10);
      
      const url = `https://api.frankfurter.app/${isoStartDate}..${endDate}?from=${base}&to=${target}`;
      const r = await fetch(url);
      if(!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    }

    async function compare(base,date,deltaDays){
      const target = date ? new Date(date) : new Date();
      target.setDate(target.getDate() - deltaDays);
      const refDate = target.toISOString().slice(0,10);
      const ref = await fetchRates(base, refDate);
      return { refDate, refRates: ref.rates || {} };
    }

    function setStatusLoading(){
      status.textContent = t.statusLoading;
      status.classList.add("is-loading");
      status.classList.remove("is-error");
    }
    function setStatusReady(){
      status.textContent = t.statusReady;
      status.classList.remove("is-loading","is-error");
    }
    function setStatusError(){
      status.textContent = t.statusError;
      status.classList.remove("is-loading");
      status.classList.add("is-error");
    }

    function activateRangeButton(range){
      rangeButtons.forEach(btn=>{
        if(btn.dataset.range === range){
          btn.classList.add("active");
        }else{
          btn.classList.remove("active");
        }
      });
    }

    // Modal AÃ§ma/Kapama FonksiyonlarÄ±
    function openModal(){
        rateModal.classList.add("open");
    }
    function closeModal(){
        rateModal.classList.remove("open");
        if(rateChartInstance) {
            rateChartInstance.destroy(); // GrafiÄŸi kapatÄ±rken temizle
            rateChartInstance = null;
        }
    }
    
    // Modal Kapatma OlaylarÄ±
    modalClose.addEventListener('click', closeModal);
    rateModal.addEventListener('click', (e) => {
        if (e.target === rateModal) { // Sadece overlay'e tÄ±klanÄ±nca kapa
            closeModal();
        }
    });

    // Chart.js GrafiÄŸi OluÅŸturma Fonksiyonu
    function createChart(labels, data, base, target){
        if(rateChartInstance) rateChartInstance.destroy();

        const ctx = rateChartCanvas.getContext('2d');
        rateChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `${base} / ${target} Kur DeÄŸeri`,
                    data: data,
                    borderColor: 'rgba(34, 211, 238, 1)',
                    backgroundColor: 'rgba(34, 211, 238, 0.2)',
                    tension: 0.3,
                    pointRadius: 3,
                    pointHoverRadius: 6,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: { 
                            color: chartTextColor     // â† artÄ±k tema rengi
                        },
                        grid: { 
                            color: 'rgba(148,163,184,0.1)' 
                        }
                    },
                    y: {
                        ticks: { 
                            color: chartTextColor     // â† aynÄ± ÅŸekilde
                        },
                        grid: { 
                            color: 'rgba(148,163,184,0.1)' 
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: { 
                            color: chartTextColor     // legend yazÄ±sÄ±
                        }
                    },
                    tooltip: {
                        backgroundColor: chartBgColor,
                        titleColor: chartTextColor,
                        bodyColor: chartTextColor,
                        borderColor: chartMutedColor,
                        borderWidth: 1
                    }
                }
            }
        });
    }

    
    // TÄ±klanan kur iÃ§in detaylÄ± bilgileri getirip modalÄ± aÃ§an fonksiyon
    async function showRateDetails(base, target, rate, amt){
        modalTitle.textContent = t.modalTitle(base, target);
        
        // Stat alanlarÄ±nÄ± sÄ±fÄ±rla/gÃ¼ncelle
        statCurrentRate.textContent = rate.toFixed(4);
        statChangePerc.textContent = "--";
        statHighest.textContent = "--";
        statLowest.textContent = "--";
        // BaÅŸlangÄ±Ã§ rengi aÃ§Ä±k mavi (Accent)
        statCurrentRate.style.color = "var(--accent)";
        statChangePerc.style.color = "var(--accent)"; 
        statHighest.style.color = "var(--accent)"; 
        statLowest.style.color = "var(--accent2)"; // FarklÄ± bir vurgu iÃ§in mor
        
        infoDetail.textContent = t.modalLoading;
        infoDetail.style.color = "var(--accent)"; // YÃ¼kleniyor yazÄ±sÄ± aÃ§Ä±k mavi
        

        // VarsayÄ±lan 30 gÃ¼nlÃ¼k veriyi Ã§ek
        const periodDays = 30; 
        try {
            const history = await fetchHistoricalRates(base, target, periodDays);
            
            if (history.rates && Object.keys(history.rates).length > 0) {
                const dates = Object.keys(history.rates).sort();
                const ratesData = dates.map(date => history.rates[date][target]);
                
                createChart(dates, ratesData, base, target);
                infoDetail.textContent = "";

                // --- STAT HESAPLAMALARI VE GÃ–RÃœNTÃœLEME ---
                
                // En YÃ¼ksek ve En DÃ¼ÅŸÃ¼k (30 GÃ¼nlÃ¼k)
                const highest = Math.max(...ratesData).toFixed(4);
                const lowest = Math.min(...ratesData).toFixed(4);
                statHighest.textContent = highest;
                statLowest.textContent = lowest;
                // En yÃ¼ksek ve En DÃ¼ÅŸÃ¼k deÄŸerler zaten CSS ile aÃ§Ä±k renk ayarlandÄ±.

                // DeÄŸiÅŸim YÃ¼zdesi (Grafikteki ilk veriye gÃ¶re son veri)
                if (ratesData.length > 1) {
                    const firstRate = ratesData[0];
                    const lastRate = ratesData[ratesData.length - 1];
                    const diff = lastRate - firstRate;
                    const perc = ((diff / firstRate) * 100).toFixed(2);
                    const diffText = diff >= 0 ? `+${perc}%` : `${perc}%`;
                    // YeÅŸil veya KÄ±rmÄ±zÄ± renk, aÃ§Ä±k mavi deÄŸil.
                    const color = diff >= 0 ? "var(--success)" : "var(--danger)";
                    
                    statChangePerc.textContent = diffText;
                    statChangePerc.style.color = color;
                }
                // --- STAT HESAPLAMALARI SONU ---

            } else {
                // Veri yoksa hata mesajÄ± gÃ¶ster
                infoDetail.textContent = t.modalNoData;
                infoDetail.style.color = "var(--danger)"; // Hata yazÄ±sÄ± kÄ±rmÄ±zÄ±
            }
        } catch(e) {
            console.error("Grafik verisi yÃ¼klenirken hata oluÅŸtu:", e);
            infoDetail.textContent = t.errorText;
            infoDetail.style.color = "var(--danger)"; // Hata yazÄ±sÄ± kÄ±rmÄ±zÄ±
        }

        openModal();
    }


    // run fonksiyonu
    async function run(range){
      try{
        setStatusLoading();
        activateRangeButton(range || "");
        
        resEl.innerHTML = `
          <div class="badge"><span class="badge-dot"></span><span>${t.mainBadge}</span></div>
          <div class="skeleton" style="width:55%;margin-top:8px;"></div>
        `;
        ratesEl.innerHTML = "";

        const base = baseEl.value || "USD";
        const date = dateEl.value ? dateEl.value : "";
        const amt = parseFloat(amtEl.value) || 1;

        const j = await fetchRates(base, date);
        const rates = j.rates || {};

        let refDateLabel = "";
        let refRates = {};
        if(range){
          const delta = range === "1g" ? 1 : range === "5g" ? 5 : 30;
          const cmp = await compare(base, date || j.date, delta);
          refDateLabel = cmp.refDate;
          refRates = cmp.refRates;
        }

        resEl.innerHTML = `
          <div class="card-header">
            <div class="badge">
              <span class="badge-dot"></span>
              <span>${t.baseLabel}: ${base}</span>
            </div>
            <span class="muted">${t.dateLabel}: ${date || j.date || ""}</span>
          </div>
          <div class="card-main">
            ${t.totalLabel}: <span class="num-anim">${Object.keys(rates).length}</span>
          </div>
          <div class="card-sub">
            ${t.mainSub}
          </div>
        `;
        
        // TÃ¼m kurlarÄ± ve referans deÄŸerlerini geÃ§ici olarak saklayalÄ±m
        const allRatesData = {};

        const entries = Object.entries(rates);
        const html = entries.map(([k,v], idx)=>{
          const conv = (v * amt).toFixed(4);
          let deltaHtml = "";
          let deltaColor = "var(--muted)";
          let refV = null;

          if(refRates[k]){
            refV = refRates[k];
            const diff = v - refV;
            const perc = ((diff / refV) * 100).toFixed(2);
            const arrow = diff >= 0 ? "â†‘" : "â†“";
            const color = diff >= 0 ? "var(--success)" : "var(--danger)";
            deltaColor = color;
            const labelText = t.compareLabel(refDateLabel);
            deltaHtml = `
              <div class="change-line" style="color:${color}">
                ${labelText}: ${refV.toFixed(4)} | ${arrow} ${perc}%
              </div>
            `;
          }

          // Veriyi sakla
          allRatesData[k] = { rate: v }; // Sadece gÃ¼ncel kuru saklamak yeterli

          const delay = 0.02 * idx;

          return `
            <div class="card" style="animation-delay:${delay}s;" data-currency="${k}" data-base="${base}">
              <div class="card-header">
                <div class="badge">
                  <span>${k}</span>
                </div>
                <span class="muted">${friendly(k)}</span>
              </div>
              <div class="card-main">
                <span class="muted">1 ${base} = </span>
                <span class="num-anim" style="color:${deltaColor}">${v.toFixed(4)}</span>
                <span class="muted"> ${k}</span>
              </div>
              <div class="card-sub">
                <span class="muted">${amt} ${base} â†’ </span>
                <span class="num-anim">${conv}</span>
                <span class="muted"> ${k}</span>
              </div>
              ${deltaHtml}
            </div>
          `;
        }).join("");

        ratesEl.innerHTML = html;
        setStatusReady();
        
        // TÄ±klama Olay Dinleyicisi (Modal/Widget'Ä± AÃ§an)
        // Ã–nceki dinleyiciyi temizle (run her Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda tekrar eklenmesin)
        ratesEl.removeEventListener('click', handleCardClick); 
        // Yeni dinleyiciyi ekle
        ratesEl.addEventListener('click', (e) => handleCardClick(e, allRatesData, amt));

      }catch(e){
        console.error(e);
        setStatusError();
        resEl.innerHTML = `
          <div class="card-main" style="color:var(--danger);">
            ${t.errorText}
          </div>
        `;
        ratesEl.innerHTML = "";
      }
    }
    
    // Kur KartÄ±na TÄ±klama Ä°ÅŸleyicisi
    function handleCardClick(e, allRatesData, amt){
        const card = e.target.closest('.card');
        if (card) {
            const targetCurrency = card.dataset.currency;
            const baseCurrency = card.dataset.base;
            const rateData = allRatesData[targetCurrency];

            if (rateData) {
                showRateDetails(
                    baseCurrency, 
                    targetCurrency, 
                    rateData.rate, 
                    amt
                );
            }
        }
    }

    document.getElementById("go").addEventListener("click", ()=>run(null));
    [baseEl, dateEl, amtEl].forEach(el=>{
      el.addEventListener("change", ()=>run(null));
    });
    rangeButtons.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        run(btn.dataset.range);
      });
    });

    // BaÅŸlangÄ±Ã§ta "hazÄ±r" metnini de dillere gÃ¶re dÃ¼zelt
    status.textContent = t.statusReady;

    run(null);
  })();
  </script>
  <script src="../lang-helper.js"></script>
  <script src="../scroll-helper.js"></script>
</body>
</html>