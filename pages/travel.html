<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Seyahat PlanlayÄ±cÄ±</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    :root { --bg:#0b1221; --panel:#101a30; --accent:#22d3ee; --accent2:#a855f7; --text:#e5e7eb; --muted:#94a3b8; }
    *{box-sizing:border-box;}
    body{margin:0;font-family:"Inter","Segoe UI",sans-serif;background:radial-gradient(circle at 20% 20%,rgba(34,211,238,0.08),transparent 30%),linear-gradient(135deg,#0b1221,#0f172a);color:var(--text);min-height:100vh;}
    header{max-width:1180px;margin:0 auto;padding:28px 16px 8px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
    .btn-home{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);background:rgba(34,211,238,0.12);color:#7dd3fc;text-decoration:none;}
    h1{margin:0;font-size:32px;letter-spacing:0.4px;}
    p.lead{margin:6px 0 0;color:var(--muted);}
    .panel{max-width:1180px;margin:0 auto 26px;padding:18px;background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:16px;box-shadow:0 24px 70px rgba(0,0,0,0.35);}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px;}
    input, select{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:#0c1528;color:#fff;min-width:180px;}
    .btn{border:none;padding:10px 14px;border-radius:12px;background:linear-gradient(120deg,rgba(34,211,238,0.8),rgba(168,85,247,0.7));color:#fff;cursor:pointer;transition:all .2s;box-shadow:0 12px 36px rgba(0,0,0,0.25);}
    .btn:hover{transform:translateY(-1px);box-shadow:0 16px 48px rgba(34,211,238,0.22);}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(34,211,238,0.12);color:#7dd3fc;border:1px solid rgba(34,211,238,0.3);cursor:pointer;transition:all .2s;}
    .chip:hover{background:rgba(34,211,238,0.2);}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;}
    .card{background:#0f182c;border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:14px;position:relative;overflow:hidden;}
    .card::after{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(34,211,238,0.08),transparent 60%);pointer-events:none;}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(34,211,238,0.15);color:#7dd3fc;font-size:12px;border:1px solid rgba(34,211,238,0.35);}
    .muted{color:var(--muted);}
    .flex{display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap;}
    .stat{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:10px;min-width:120px;text-align:center;}
    .floaty{animation:float 5s ease-in-out infinite;}
    @keyframes float {0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
    #map{height:320px;border-radius:12px;border:1px solid rgba(255,255,255,0.05);}
  </style>
</head>
<body>
  <header>
    <a class="btn-home" href="../index.html">Ana sayfa</a>
    <div>
      <h1>Seyahat PlanlayÄ±cÄ±</h1>
      <p class="lead">Åehir, rota, harita; popÃ¼ler yerler iÃ§in gÃ¼nlÃ¼k Ã¶neri.</p>
    </div>
  </header>
  <div class="panel">
    <div class="bar">
      <input id="city" placeholder="Åehir veya Ã¼lke (Ã¶rn: Tokyo)">
      <input id="dest" placeholder="VarÄ±ÅŸ (opsiyonel)">
      <button class="btn" id="search">Ara</button>
      <span class="badge" id="status">HazÄ±r</span>
    </div>
    <div class="chips" id="preset"></div>
    <div class="grid" id="cards">
      <div class="card">Åehir seÃ§in.</div>
    </div>
    <div class="card" style="margin-top:12px;">
      <div class="badge">Harita & Mesafe</div>
      <div id="map"></div>
      <div class="muted" id="routeInfo" style="margin-top:8px;"></div>
    </div>
    <div class="card" id="planCard" style="margin-top:12px;">
      <div class="badge">GÃ¼nlÃ¼k Plan</div>
      <ol id="planList" class="muted"></ol>
    </div>
  </div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  (function(){
    const presets=["Istanbul","London","Paris","Tokyo","New York","Dubai","Rome","Barcelona"];
    const cards=document.getElementById("cards");
    const status=document.getElementById("status");
    const cityInput=document.getElementById("city");
    const destInput=document.getElementById("dest");
    const presetWrap=document.getElementById("preset");
    const routeInfo=document.getElementById("routeInfo");
    const planList=document.getElementById("planList");
    presetWrap.innerHTML=presets.map(p=>`<span class="chip" data-city="${p}">${p}</span>`).join("");
    presetWrap.addEventListener("click",e=>{
      const c=e.target.dataset.city;
      if(!c) return;
      if(document.activeElement===destInput){
        destInput.value=c;
      } else if(!cityInput.value){
        cityInput.value=c;
        loadCity(c);
        return;
      } else if(!destInput.value){
        destInput.value=c;
      } else {
        cityInput.value=c;
        destInput.value="";
        loadCity(c);
        return;
      }
      if(cityInput.value) loadCity(cityInput.value);
    });

    document.getElementById("search").addEventListener("click",()=>loadCity(cityInput.value.trim()));
    cityInput.addEventListener("keydown",e=>{if(e.key==="Enter") loadCity(cityInput.value.trim());});
    destInput.addEventListener("keydown",e=>{if(e.key==="Enter") loadCity(cityInput.value.trim());});

    const weatherIcons={0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",51:"ğŸŒ¦ï¸",61:"ğŸŒ§ï¸",71:"ğŸŒ¨ï¸",80:"ğŸŒ§ï¸",95:"â›ˆï¸"};
    const poiDb={
      Istanbul:["Galata Kulesi","TopkapÄ± SarayÄ±","Ayasofya","Sultanahmet","KarakÃ¶y","KadÄ±kÃ¶y Ã‡arÅŸÄ±sÄ±"],
      Paris:["Eiffel","Louvre","Notre Dame","Montmartre","Luxembourg Park"],
      Tokyo:["Senso-ji","Shibuya Crossing","Meiji Shrine","Akihabara","Ueno Park"],
      Rome:["Colosseum","Trevi","Pantheon","Vatican"],
      London:["Big Ben","London Eye","British Museum","Borough Market"],
      "New York":["Central Park","Times Square","MoMA","Brooklyn Bridge"]
    };
    function fmt(n){return typeof n==="number"?n.toFixed(1):n;}
    function haversine(a,b){const R=6371,toRad=x=>x*Math.PI/180;const dLat=toRad(b.lat-a.lat),dLon=toRad(b.lon-a.lon);const lat1=toRad(a.lat),lat2=toRad(b.lat);const h=Math.sin(dLat/2)**2+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;return 2*R*Math.asin(Math.sqrt(h));}

    const map=L.map("map").setView([39,35],5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}).addTo(map);
    let markers=[];
    let poly=null;
    function setMarkers(points){
      markers.forEach(m=>map.removeLayer(m));
      markers=points.map(p=>L.marker([p.lat,p.lon]).addTo(map).bindPopup(p.name||"Konum"));
      if(points.length) map.fitBounds(points.map(p=>[p.lat,p.lon]),{padding:[20,20]});
      if(poly){map.removeLayer(poly);}
      if(points.length===2){
        poly=L.polyline([[points[0].lat,points[0].lon],[points[1].lat,points[1].lon]],{color:'#22d3ee',weight:3,dashArray:'6 6'}).addTo(map);
      }
    }

    async function loadCity(name){
      if(!name){cards.innerHTML="<div class='card'>LÃ¼tfen ÅŸehir yazÄ±n.</div>";return;}
      try{
        status.textContent="YÃ¼kleniyor...";
        const geoRes=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=tr`);
        const geo=await geoRes.json();
        const item=geo?.results?.[0];
        if(!item){cards.innerHTML="<div class='card'>Åehir bulunamadÄ±.</div>";status.textContent="HazÄ±r";return;}
        const {latitude,longitude,name:city,country,country_code}=item;
        const destName=destInput.value.trim();
        let dest=null;
        if(destName){
          const dRes=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(destName)}&count=1&language=tr`);
          const dj=await dRes.json();
          dest=dj?.results?.[0] ? {lat:dj.results[0].latitude,lon:dj.results[0].longitude,name:dj.results[0].name,country:dj.results[0].country} : null;
        }

        const weatherRes=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weathercode,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`);
        const weather=await weatherRes.json();
        let countryInfo=null;
        if(country_code){
          try{
            const cRes=await fetch(`https://restcountries.com/v3.1/alpha/${country_code}`);
            const cj=await cRes.json();
            countryInfo=cj?.[0]||null;
          }catch(err){}
        }
        const currentCode=weather?.current?.weathercode;
        const currentIcon=weatherIcons[currentCode]||"ğŸŒ";
        const todayMax=weather?.daily?.temperature_2m_max?.[0];
        const todayMin=weather?.daily?.temperature_2m_min?.[0];
        const rainProb=weather?.daily?.precipitation_probability_max?.[0];
        const pop=countryInfo?.population ? (countryInfo.population/1_000_000).toFixed(1)+"m" : "Bilinmiyor";
        const currency=countryInfo?.currencies ? Object.keys(countryInfo.currencies)[0] : "-";
        const tz=countryInfo?.timezones?.[0] || "Yerel";
        const budgetBase=60 + (countryInfo?.population? Math.min(countryInfo.population/5_000_000,8)*10:20);
        const budgetCards=[{label:"BÃ¼tÃ§e",val:Math.round(budgetBase*0.7)},{label:"Konfor",val:Math.round(budgetBase)},{label:"LÃ¼ks",val:Math.round(budgetBase*1.4)}];
        const inspo=poiDb[city] || ["Eski ÅŸehir turu","Yerel sokak lezzetleri","GÃ¼n batÄ±mÄ± manzarasÄ±","MÃ¼ze/galeri ziyareti","Parkta yÃ¼rÃ¼yÃ¼ÅŸ"];

        cards.innerHTML=`
          <div class="card floaty">
            <div class="badge">${city}, ${country}</div>
            <h2 style="margin:6px 0 4px;">${currentIcon} ${fmt(weather?.current?.temperature_2m)}Â°C</h2>
            <p class="muted">RÃ¼zgar: ${fmt(weather?.current?.wind_speed_10m)} km/s Â· YaÄŸÄ±ÅŸ ihtimali: ${rainProb ?? "-"}%</p>
            <div class="flex">
              <div class="stat"><div class="muted">BugÃ¼n</div><strong>${fmt(todayMin)} / ${fmt(todayMax)}Â°C</strong></div>
              <div class="stat"><div class="muted">Saat dilimi</div><strong>${tz}</strong></div>
              <div class="stat"><div class="muted">NÃ¼fus</div><strong>${pop}</strong></div>
              <div class="stat"><div class="muted">Para birimi</div><strong>${currency}</strong></div>
            </div>
          </div>
          <div class="card">
            <div class="badge">BÃ¼tÃ§e Tahmini (gÃ¼nlÃ¼k)</div>
            <div class="flex">
              ${budgetCards.map(b=>`<div class="stat"><div class="muted">${b.label}</div><strong>$${b.val}</strong></div>`).join("")}
            </div>
            <p class="muted" style="margin-top:8px;">Tahminler ÅŸehir popÃ¼lasyonu ve bÃ¶lgeye gÃ¶re kaba hesaplamadÄ±r.</p>
          </div>
          <div class="card">
            <div class="badge">Ä°lham</div>
            <div class="chips">
              ${inspo.map(i=>`<span class="chip">${i}</span>`).join("")}
            </div>
          </div>
        `;

        // Mesafe & sÃ¼re
        const points=[{lat:latitude,lon:longitude,name:city}];
        if(dest) points.push({lat:dest.lat,lon:dest.lon,name:dest.name});
        setMarkers(points);
        if(dest){
          const km=haversine(points[0],points[1]);
          const modes=[{m:"Araba",v:80},{m:"Tren",v:120},{m:"UÃ§uÅŸ",v:700},{m:"YÃ¼rÃ¼yÃ¼ÅŸ",v:5}];
          routeInfo.textContent=`Mesafe ${km.toFixed(1)} km Â· ${modes.map(m=>`${m.m}: ${(km/m.v*60).toFixed(0)} dk`).join(" Â· ")}`;
        }else{
          routeInfo.textContent="VarÄ±ÅŸ yazarsanÄ±z mesafe ve sÃ¼releri gÃ¶rÃ¼rsÃ¼nÃ¼z.";
        }

        // GÃ¼nlÃ¼k plan kaldÄ±rÄ±ldÄ±; ÅŸehir spesifik veri olmadÄ±ÄŸÄ± iÃ§in boÅŸ bÄ±rakÄ±yoruz
        planList.innerHTML = dest ? `<li>${city} - ${dest.name} arasÄ± rota Ã§izildi. Åehir iÃ§i planÄ± kendin seÃ§ebilirsin.</li>` : "<li>VarÄ±ÅŸ yazarsan rota Ã§izilir.</li>";

        status.textContent="HazÄ±r";
      }catch(err){
        console.error(err);
        status.textContent="Hata";
        cards.innerHTML="<div class='card'>Veri alÄ±namadÄ±.</div>";
      }
    }
    loadCity("Istanbul");
  })();
  </script>
</body>
</html>
