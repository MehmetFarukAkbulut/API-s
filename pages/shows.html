<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dizi</title>
  <style>
    :root { --bg:#0b1221; --panel:#101a30; --accent:#22d3ee; --text:#e5e7eb; --muted:#94a3b8; }
    *{box-sizing:border-box;}
    body{margin:0;font-family:"Inter","Segoe UI",sans-serif;background:radial-gradient(circle at 20% 20%,rgba(34,211,238,0.08),transparent 30%),linear-gradient(135deg,#0b1221,#0f172a);color:var(--text);}
    header{max-width:1100px;margin:0 auto;padding:26px 16px 10px;}
    h1{margin:0;font-size:30px;}
    p.lead{margin:6px 0 0;color:var(--muted);}
    .panel{max-width:1100px;margin:0 auto 26px;padding:16px;background:var(--panel);border:1px solid rgba(255,255,255,0.06);border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,0.35);}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px;}
    input{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.12);background:#0c1528;color:#fff;min-width:220px;}
    .btn{border:none;padding:10px 14px;border-radius:10px;background:linear-gradient(120deg,rgba(34,211,238,0.6),rgba(168,85,247,0.5));color:#fff;cursor:pointer;transition:all .2s;box-shadow:0 10px 30px rgba(0,0,0,0.25);}
    .btn:hover{transform:translateY(-1px);box-shadow:0 15px 40px rgba(34,211,238,0.25);}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(34,211,238,0.12);color:#7dd3fc;border:1px solid rgba(34,211,238,0.3);cursor:pointer;}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;}
    .card{padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);background:#0f182c;display:flex;flex-direction:column;gap:6px;}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(34,211,238,0.12);border:1px solid rgba(34,211,238,0.3);color:#7dd3fc;font-size:12px;}
    .muted{color:var(--muted);}
    .poster{
      width:100%;
      aspect-ratio:210/295;
      height:auto;
      object-fit:cover;
      border-radius:10px;
      box-shadow:0 10px 26px rgba(0,0,0,0.35);
    }
    .modal{
      position:fixed;inset:0;background:rgba(0,0,0,0.65);
      display:none;align-items:center;justify-content:center;
      backdrop-filter:blur(8px);z-index:20;padding:14px;
    }
    .modal.open{display:flex;}
    .modal-content{
      width:min(900px,100%);max-height:90vh;overflow:auto;
      background:#0b1221;border:1px solid rgba(255,255,255,0.08);
      border-radius:16px;box-shadow:0 30px 90px rgba(0,0,0,0.5);
      padding:16px;position:relative;
    }
    .modal img{
      width:100%;
      height:auto;
      max-height:80vh;
      object-fit:contain;
      border-radius:12px;
      box-shadow:0 16px 40px rgba(0,0,0,0.45);
    }
    .modal h2{margin:12px 0 6px;}
    .modal .meta{color:var(--muted);font-size:14px;margin-bottom:8px;}
    .modal .summary{color:var(--muted);line-height:1.6;}
    .modal .close{
      position:absolute;top:10px;right:10px;border:none;
      background:rgba(255,255,255,0.08);color:#fff;border-radius:10px;
      padding:8px 10px;cursor:pointer;
    }
    .modal .link{
      margin-top:10px;display:inline-flex;align-items:center;gap:6px;
      padding:9px 12px;border-radius:10px;border:1px solid rgba(34,211,238,0.5);
      color:#7dd3fc;text-decoration:none;background:rgba(34,211,238,0.12);
    }
    @media(max-width:768px){
      .bar,.chips{flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:6px;margin-bottom:12px;}
      .bar::-webkit-scrollbar,.chips::-webkit-scrollbar{display:none;}
      .bar>*,.chips>*{flex:0 0 auto;}
      .modal-content{padding:12px;}
    }
    @media (prefers-reduced-motion: reduce){
      *{animation:none !important;transition:none !important;}
    }
  </style>
</head>
<body>
  <header>
    <h1>Diziler</h1>
    <p class="lead">TVMaze ile arama; tür filtreleri ve puanlar.</p>
  </header>
  <div class="panel">
    <div class="bar">
      <a class="btn" href="../index.html">Ana sayfa</a>
      <input id="q" placeholder="Dizi adı (örn: Lost)">
      <button class="btn" id="go">Ara</button>
      <span class="badge" id="status">Hazır</span>
    </div>
    <div class="chips" id="chips"></div>
    <div class="grid" id="grid"><div class="card">Arama yapın veya tür seçin.</div></div>
    <div class="bar" style="justify-content:flex-end;margin-top:10px;">
      <button class="btn" id="more">Daha fazla</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="close" id="modalClose">Kapat</button>
      <img id="modalImg" alt="">
      <h2 id="modalTitle"></h2>
      <div class="meta" id="modalMeta"></div>
      <div class="summary" id="modalSummary"></div>
      <a class="link" id="modalLink" href="#" target="_blank" rel="noreferrer">Detay sayfasına git</a>
    </div>
  </div>
  <script>
  (function(){
    const chips=document.getElementById("chips");
    const grid=document.getElementById("grid");
    const status=document.getElementById("status");
    const q=document.getElementById("q");
    const more=document.getElementById("more");
    const modal=document.getElementById("modal");
    const modalImg=document.getElementById("modalImg");
    const modalTitle=document.getElementById("modalTitle");
    const modalMeta=document.getElementById("modalMeta");
    const modalSummary=document.getElementById("modalSummary");
    const modalLink=document.getElementById("modalLink");
    const modalClose=document.getElementById("modalClose");
    const genres=["Drama","Comedy","Science-Fiction","Documentary","Anime","Action","Fantasy"];
    chips.innerHTML=genres.map(g=>`<span class="chip" data-genre="${g}">${g}</span>`).join("");
    chips.addEventListener("click",e=>{const g=e.target.dataset.genre;if(g) filterGenre(g);});

    document.getElementById("go").addEventListener("click",()=>load(q.value.trim(),null));
    q.addEventListener("keydown",e=>{if(e.key==="Enter") load(q.value.trim(),null);});

    function stripTags(str){return (str||"").replace(/<[^>]*>/g,"");}

    let baseList=[]; let page=0; const pageSize=20;
    let currentList=[];
    async function load(term){
      try{
        status.textContent="Yükleniyor...";
        let url="";
        if(term){ url=`https://api.tvmaze.com/search/shows?q=${encodeURIComponent(term)}`; }
        else { url="https://api.tvmaze.com/shows?page=1"; }
        const res=await fetch(url);
        const data=await res.json();
        const shows = Array.isArray(data) ? (term ? data.map(s=>s.show) : data.slice(0,200)) : [];
        baseList=shows;
        page=0;
        render(shows);
        status.textContent="Hazır";
      }catch(err){
        status.textContent="Hata";
        grid.innerHTML="<div class='card'>Veri alınamadı.</div>";
      }
    }

    function render(list){
      if(!list.length){grid.innerHTML="<div class='card'>Sonuc yok</div>";currentList=[];return;}
      const sorted=list.sort((a,b)=>(b.rating?.average||0)-(a.rating?.average||0));
      const startIdx=page*pageSize;
      const finalList=sorted.slice(0,startIdx+pageSize);
      currentList=finalList;
      grid.innerHTML=finalList.map(show=>{
          const poster = show.image?.medium || show.image?.original || "";
          return `
          <div class="card" data-id="${show.id||""}">
            <div class="badge">${show.genres?.[0]||"Tur"}</div>
            ${poster ? `<img class="poster" src="${poster}" alt="${show.name||""}" loading="lazy">` : ""}
            <strong>${show.name||""}</strong>
            <div class="muted">Puan: ${show.rating?.average ?? "?"}</div>
            <p class="muted">${stripTags(show.summary).slice(0,140)}...</p>
            ${show.url ? `<a class="btn" href="${show.url}" target="_blank" rel="noreferrer">Detay</a>` : ""}
          </div>`;
        }).join("");
    }

    function openModal(show){
      if(!show) return;
      const poster = show.image?.original || show.image?.medium || "";
      if(poster){ modalImg.src = poster; modalImg.style.display = "block"; }
      else { modalImg.src=""; modalImg.style.display="none"; }
      modalTitle.textContent = show.name || "";
      const genresText = (show.genres||[]).join(", ") || "Tur bilgisi yok";
      const rating = show.rating?.average ?? "?";
      modalMeta.textContent = `${genresText} · Puan: ${rating}`;
      modalSummary.textContent = stripTags(show.summary || "Ozet bulunamadi.");
      if(show.url){
        modalLink.href = show.url;
        modalLink.style.display = "inline-flex";
      }else{
        modalLink.style.display = "none";
      }
      modal.classList.add("open");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      modal.classList.remove("open");
      document.body.style.overflow = "";
    }

    grid.addEventListener("click",(e)=>{
      const card = e.target.closest(".card[data-id]");
      if(!card) return;
      const id = card.dataset.id;
      const show = currentList.find(s => String(s.id) === id);
      openModal(show);
    });

    modal.addEventListener("click",(e)=>{ if(e.target === modal) closeModal(); });
    modalClose.addEventListener("click", closeModal);
    document.addEventListener("keydown",(e)=>{ if(e.key === "Escape" && modal.classList.contains("open")) closeModal(); });

    function filterGenre(g){
      if(!baseList.length){load();return;}
      const filtered=baseList.filter(s=>s.genres?.some(x=>x.toLowerCase().includes(g.toLowerCase())));
      page=0;
      render(filtered.length?filtered:baseList);
    }
    more.addEventListener("click",()=>{ if(!baseList.length) return; page++; render(baseList); });
    // ilk açılışta trend
    load("");
  })();
  </script>
</body>
</html>
